(function(e){function t(t){for(var n,r,o=t[0],l=t[1],c=t[2],d=0,p=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&p.push(s[r][0]),s[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],n=!0,o=1;o<a.length;o++){var l=a[o];0!==s[l]&&(n=!1)}n&&(i.splice(t--,1),e=r(r.s=a[0]))}return e}var n={},s={app:0},i=[];function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/loviot/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("85ec"),s=a.n(n);s.a},1:function(e,t){},5490:function(e,t,a){"use strict";var n=a("a6b6"),s=a.n(n);s.a},"56d7":function(e,t,a){"use strict";a.r(t),a.d(t,"eventBus",(function(){return C}));a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[e._v(" Select what to measure: "),a("select",{on:{change:function(t){return e.entity(t)}}},[a("option",{attrs:{disabled:"",value:""}},[e._v("Please select one")]),a("option",{domProps:{value:e.selectairqualityObserved}},[e._v("AirQualityObserved – Stadens referensstationer för NO2")]),a("option",{domProps:{value:e.selectNO2B43F}},[e._v("Sensorbox - Projektets mätstationer för NO2 (4 st)")]),a("option",{domProps:{value:e.selectSDS011}},[e._v("Luftdatens mätstationer för PM 2.5")])]),a("span",{attrs:{id:"date"}},[e._v("Select startdate:")]),a("flat-pickr",{attrs:{config:e.config},on:{"on-change":e.changeTime},model:{value:e.initDate,callback:function(t){e.initDate=t},expression:"initDate"}}),a("button",{attrs:{id:"prev"},on:{mousedown:function(t){return e.prevTime("down")},mouseup:function(t){return e.prevTime("up")}}},[e._v("<")]),a("button",{attrs:{id:"date"},on:{click:e.playButton}},[e._v(e._s(e.play))]),a("button",{attrs:{id:"next"},on:{mousedown:function(t){return e.nextTime("down")},mouseup:function(t){return e.nextTime("up")}}},[e._v(">")]),a("span",{attrs:{id:"date"}},[e._v("Time: "+e._s(e.displayTime))]),a("vue-slider",e._b({ref:"slider",attrs:{id:"margin-b",marks:e.options.marksIntervall},nativeOn:{click:function(t){e.getValueWhenClicked(e.$refs.slider.getValue())}},model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.options,!1)),a("Map"),a("Airdata",{ref:"child",attrs:{sensorData:e.sensorData,playToggle:e.playToggle,nextVal:e.next,prevVal:e.prev,newInc:e.newInc},on:{changeIncVal:e.getIncValue,changeTimeVal:e.getTimeValue,timeStampList:e.getTimeStamp}})],1)},i=[],r=(a("fb6a"),a("ac1f"),a("5319"),a("1276"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._m(0),e.wait?a("div",e._l(e.sensorValue,(function(t,n){return a("div",{key:t.sensor},[null!=e.airdata[2][n]?a("span",[a("b",[e._v("Sensor"+e._s(n+1)+":")]),e._v(" "+e._s(e.airdata[0])+" "),e._l(e.airdata.length-1,(function(t){return a("span",{key:t},[a("span",{attrs:{id:"col2"}},[a("b",[e._v(e._s(e.title[t-1]))]),e._v(" "+e._s(e.airdata[t][n])+" ")])])}))],2):e._e(),null==e.airdata[2][n]?a("span",[a("span",{attrs:{id:"col1"}},[a("b",[e._v("Sensor"+e._s(n+1)+":")]),e._v(" "+e._s(e.airdata[0])+" "),e._l(e.airdata.length-1,(function(t){return a("span",{key:t},[a("b",[e._v(e._s(e.title[t-1]))]),e._v(" "+e._s(e.airdata[t][n])+" ")])}))],2)]):e._e()])})),0):e._e(),a("br")])}),o=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("br")])}],l=(a("4160"),a("a434"),a("a9e3"),a("d3b7"),a("159b"),a("ddb0"),a("bc3a")),c=a.n(l),u=a("8055"),d=a.n(u),p=d.a.connect("http://localhost:3000"),h={name:"Airdata",props:{sensorData:{type:Array},playToggle:{type:Boolean},nextVal:{type:Boolean},prevVal:{type:Boolean},newInc:{type:Number}},data:function(){return{sensorType:"",fromDate:"",latitude:[],longitude:[],sensorValue:[],attributeName:"",airdata:[],inc:0,sensVal:"",latVal:"",lonVal:"",timeVal:"",timestamp:[],updatedSensorVal:[],updatedTimeVal:[],updatedLonVal:[],updatedLatVal:[],sensors:[],updatedSensors:[],title:["time: ","value: ","lat: ","lon: "],wait:!1,prevnext:0,next:0,prev:0,encoderVal:0,limit:100,now:0,then:0,interval:1e3,delta:0,incAmount:1,headers:{"Fiware-service":"loviot","Fiware-servicepath":"/air/gbg","X-Auth-Token":"c44c7dc0a5e625b5b5ae002ee600bd9d8af1346c","X-Requested-With":"XMLHttpRequest"}}},created:function(){var e=this;p.on("encoder",(function(t){e.encoderVal=t}))},methods:{getData:function(e){var t=this;this.wait=!1,this.sensors.length=0,this.encoderVal=0;var a="https://cors-anywhere.tiigbg.se/",n="http://62.88.149.35:8068/v2/entities/";e[0].forEach((function(e){t.sensors.push(e)})),this.sensorType=e[6].sensor,this.headers={"Fiware-service":"loviot","Fiware-servicepath":e[5].servicePath,"X-Auth-Token":"c44c7dc0a5e625b5b5ae002ee600bd9d8af1346c","X-Requested-With":"XMLHttpRequest"},this.sensVal=parseInt(e[1].val),this.latVal=parseInt(e[2].lat),this.lonVal=parseInt(e[3].lon),this.timeVal=parseInt(e[4].time);var s=[];this.sensors.forEach((function(i){s.push(c.a.get(a+n+i.sensorUrl+"?fromDate="+e[7].fromDate+"&limit="+t.limit,{headers:t.headers}).catch((function(s){console.log("noddata",s,"Url:",a+n+i.sensorUrl+"?fromDate="+e[7].fromDate+"&limit="+t.limit,"Headers: ",t.headers)})))})),c.a.all(s).then(c.a.spread((function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];t.updatedSensors=a,t.wait=!0,t.sensorValue.splice(0),t.latitude.splice(0),t.longitude.splice(0),t.timestamp.splice(0),"AirqualityObserved"==t.sensorType?(t.updatedSensors.forEach((function(e){try{t.sensorValue.push(e.data.data.attributes[t.sensVal].values),t.latitude.push(e.data.data.attributes[t.latVal].values),t.longitude.push(e.data.data.attributes[t.lonVal].values),t.timestamp.push(e.data.data.index)}catch(a){console.log("UNDEFINED sensor, some sensors seems to be down")}})),t.attributeName=t.updatedSensors[0].data.data.attributes[t.sensVal].attrName):"NO2B43F"==t.sensorType?(t.updatedSensors.forEach((function(e){try{t.sensorValue.push(e.data.data.attributes[t.sensVal].values),t.latitude.push(e.data.data.attributes[t.latVal].values),t.longitude.push(e.data.data.attributes[t.lonVal].values),t.timestamp.push(e.data.data.attributes[t.timeVal].values)}catch(a){console.log("UNDEFINED sensor, some sensors seems to be down")}})),t.attributeName=t.updatedSensors[0].data.data.attributes[t.sensVal].attrName):"SDS011"==t.sensorType&&(t.updatedSensors.forEach((function(e){try{t.sensorValue.push(e.data.data.attributes[t.sensVal].values),t.latitude.push(e.data.data.attributes[t.latVal].values),t.longitude.push(e.data.data.attributes[t.lonVal].values),t.timestamp.push(e.data.data.attributes[t.timeVal].values)}catch(a){console.log("UNDEFINED sensor, some sensors seems to be down")}})),t.attributeName=t.updatedSensors[0].data.data.attributes[t.sensVal].attrName)}))).catch((function(e){console.log("ERROR_airdata.vue",e)}))},loop:function(){var e=this;if(requestAnimationFrame(this.loop),this.inc=this.inc+this.nextVal,console.log("encoderVal",this.encoderVal),this.inc=this.inc-this.prevVal,this.now=Date.now(),this.delta=this.now-this.then,this.delta>this.interval){if(this.then=this.now-this.delta%this.interval,this.playToggle?this.incAmount=1:this.incAmount=0,this.updatedSensorVal.splice(0),this.updatedTimeVal.splice(0),this.updatedLatVal.splice(0),this.updatedLonVal.splice(0),this.inc>=this.limit&&(this.inc=0),"AirqualityObserved"==this.sensorType)try{this.sensorValue.forEach((function(t){e.updatedSensorVal.push(t[e.inc])})),this.timestamp.forEach((function(t){e.updatedTimeVal.push(t[e.inc].replace("T"," ").replace(".000",""))})),this.longitude.forEach((function(t){e.updatedLonVal.push(t[e.inc].coordinates[1])})),this.latitude.forEach((function(t){e.updatedLatVal.push(t[e.inc].coordinates[0])}))}catch(t){console.log("no data yet for the loop ...")}else if("NO2B43F"==this.sensorType)try{this.sensorValue.forEach((function(t){e.updatedSensorVal.push(t[e.inc])})),this.timestamp.forEach((function(t){e.updatedTimeVal.push(t[e.inc])})),this.longitude.forEach((function(t){e.updatedLonVal.push(t[e.inc])})),this.latitude.forEach((function(t){e.updatedLatVal.push(t[e.inc])}))}catch(t){console.log("no data yet for the loop ...")}else if("SDS011"==this.sensorType)try{this.sensorValue.forEach((function(t){e.updatedSensorVal.push(t[e.inc])})),this.timestamp.forEach((function(t){e.updatedTimeVal.push(t[e.inc].replace("T"," ").replace(".000",""))})),this.longitude.forEach((function(t){e.updatedLonVal.push(t[e.inc])})),this.latitude.forEach((function(t){e.updatedLatVal.push(t[e.inc])}))}catch(t){console.log("no data yet for the loop ...")}this.inc+=this.incAmount,this.sendToMap(),console.log("FDSAFDF",this.encoderVal)}this.inc+=this.encoderVal},sendToMap:function(){this.airdata=[this.attributeName,this.updatedTimeVal,this.updatedSensorVal,this.updatedLatVal,this.updatedLonVal,this.wait],C.$emit("passAirdata",this.airdata)}},watch:{timestamp:function(e){this.$emit("timeStampList",e)},inc:function(e){this.$emit("changeIncVal",e)},updatedTimeVal:function(e){this.$emit("changeTimeVal",e)},sensorData:{deep:!0,immediate:!0,handler:function(e){try{this.getData(e),this.loop(),this.then=Date.now(),this.inc=0}catch(t){console.log("no data yet ...")}}},newInc:{deep:!0,immediate:!0,handler:function(e){try{this.inc=e}catch(t){console.log("no data yet ...")}}}}},f=h,m=(a("a64b"),a("2877")),v=Object(m["a"])(f,r,o,!1,null,"29267efd",null),b=v.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"basic"},[a("l-map",{attrs:{zoom:e.zoom,center:e.center}},[a("l-tile-layer",{attrs:{url:e.url}}),e.wait?a("div",e._l(e.markers,(function(t,n){return a("div",{key:t.markers},[null!=e.sensorValue[n]?a("div",[e._v(" "+e._s(e.sensorValue)+" "),a("l-marker",{attrs:{"lat-lng":t.latlng,icon:t.pulseIcon}})],1):e._e()])})),0):e._e()],1)],1)])},g=[],y=a("2699"),D=a("a40a"),V=a("4e2b"),T=a("5698"),w=a("e11e"),_=a.n(w);a("e775");_.a.Icon.Pulse=_.a.DivIcon.extend({options:{className:"",iconSize:[12,12],color:"red"},initialize:function(e){_.a.setOptions(this,e);var t="lpi-"+(new Date).getTime()+"-"+Math.round(1e5*Math.random());this.options.className=this.options.className+" leaflet-pulsing-icon "+t;var a="."+t+"{background-color:"+this.options.color+";}";a+="."+t+":after{box-shadow: 0 0 6px 2px "+this.options.color+";}";var n=document.createElement("style");n.styleSheet?n.styleSheet.cssText=a:n.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(n),_.a.DivIcon.prototype.initialize.call(this,e)}}),_.a.icon.pulse=function(e){return new _.a.Icon.Pulse(e)},delete w["Icon"].Default.prototype._getIconUrl,w["Icon"].Default.mergeOptions({iconRetinaUrl:a("584d"),iconUrl:a("6397"),shadowUrl:a("e2b9")});var O={name:"Map",components:{LMap:y["a"],LTileLayer:D["a"],LMarker:V["a"]},data:function(){return{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",zoom:13.4,center:[57.7045,11.97035],airdata:[],attributeName:"",sensorValue:[],timestamp:[],circles:[],markers:[],wait:!1,colorScale:T["a"]().domain([0,40,90]).range(["#00FF00","#FFFF00","#FF0000"])}},created:function(){var e=this;C.$on("passAirdata",(function(t){e.airData=t,e.attributeName=t[0],e.timestamp=t[1],e.sensorValue=t[2],e.latlngs=[[57.70871,11.97035,1]],e.circles.splice(0),e.wait=t[5];for(var a=0;a<e.airData[1].length;a++)try{0==a&&e.markers.splice(0);var n=e.colorScale(e.airData[2][a]).slice(0,3)+"a"+e.colorScale(e.airData[2][a]).slice(3,e.colorScale(e.airData[2][a]).length-1)+", 0.7)";e.markers.push({latlng:[e.airData[3][a],e.airData[4][a]],pulseIcon:_.a.icon.pulse({iconSize:[18,18],color:n})})}catch(s){console.log("UNDEFINED")}}))},methods:{update:function(){}}},k=O,x=(a("5490"),Object(m["a"])(k,S,g,!1,null,null,null)),N=x.exports,U=a("c38f"),F=a.n(U),E=(a("0952"),a("4971")),A=a.n(E),I=(a("24df"),{name:"App",components:{Airdata:b,Map:N,flatPickr:F.a,VueSlider:A.a},data:function(){var e=this;return{newInc:0,inc:0,sliderValue:0,options:{dotSize:14,marksIntervall:function(t){try{return t%10===0&&t<100&&t>0?"SDS011Selection"==e.selected?{label:"".concat(e.timestampList[0][t].replace("T"," ").replace(".000","").slice(0,-4))}:{label:"".concat(e.timestampList[0][t].replace("T"," ").replace(".000",""))}:{label:""}}catch(a){console.log("waiting for dateticks to load")}},width:"auto",height:4,contained:!0,direction:"ltr",data:null,min:0,max:100,interval:1,disabled:!1,clickable:!0,duration:.5,adsorb:!0,lazy:!0,tooltip:"none",tooltipPlacement:"top",tooltipFormatter:void 0,useKeyboard:!0,keydownHook:null,dragOnClick:!0,enableCross:!0,fixed:!0,minRange:void 0,maxRange:void 0,order:!0,marks:[10,20,30,40,50],dotOptions:{style:{backgroundColor:"#3c656b",border:"2px solid #9cb2bf",boxShadow:"0.5px 0.5px 2px 1px rgba(107,107,107,.36)"}},process:!0,showTooltip:!0,dotStyle:{backgroundColor:"black"},railStyle:{backgroundColor:"#9cb2bf"},processStyle:{backgroundColor:"#3c656b"},tooltipStyle:{backgroundColor:"red"},stepStyle:{backgroundColor:"black"},labelActiveStyle:{backgroundColor:"transparent"},stepActiveStyle:{backgroundColor:"transparent"},labelStyle:{backgroundColor:"transparent"}},initDate:"2019-11-30t09:00:00",play:"Pause",playToggle:!0,counter:0,prev:!1,next:!1,config:{wrap:!0,altFormat:"Y-m-d H:i",minDate:"2019-11-01",maxDate:"2020-06-15",altInput:!0,minuteIncrement:60,dateFormat:"Y-m-d"},timestamp:"Year-month-day Hours-Minutes-Seconds",timestampList:[],displayTime:"Year-month-day Hours-Minutes-Seconds",timeFormatter:T["b"]("%Y-%m-%dt%H:%M:%S"),selected:"airqualityObservedSelection",selectairqualityObserved:"airqualityObservedSelection",selectNO2B43F:"NO2B43FSelection",selectSDS011:"SDS011Selection",dataAirqualityObserved:[[{sensorUrl:"AirQualityObserved:0001"},{sensorUrl:"AirQualityObserved:0002"},{sensorUrl:"AirQualityObserved:0003"}],{val:0},{lat:5},{lon:5},{time:12},{servicePath:"/airquality/reference"},{sensor:"AirqualityObserved"},{fromDate:this.initDate}],dataNO2B43F:[[{sensorUrl:"NO2B43F:b9455f7d07034bcfa44a5be9002187a7-02"},{sensorUrl:"NO2B43F:ead4f525b1fd498db0e33f6b66bc2e01-02"},{sensorUrl:"NO2B43F:94d359a386ef4e9599246af00eb66116-02"},{sensorUrl:"NO2B43F:5efba162-70df-4887-88f2-463c12b8729c-02"}],{val:5},{lat:3},{lon:4},{time:12},{servicePath:"/air/gbg"},{sensor:"NO2B43F"},{fromDate:this.initDate}],dataSDS011:[[{sensorUrl:"SDS011:12397"},{sensorUrl:"SDS011:14801"},{sensorUrl:"SDS011:14264"},{sensorUrl:"SDS011:19796"},{sensorUrl:"SDS011:24589"},{sensorUrl:"SDS011:14807"},{sensorUrl:"SDS011:24625"},{sensorUrl:"SDS011:13439"},{sensorUrl:"SDS011:11006"},{sensorUrl:"SDS011:24835"},{sensorUrl:"SDS011:16723"},{sensorUrl:"SDS011:11556"},{sensorUrl:"SDS011:13018"},{sensorUrl:"SDS011:26612"},{sensorUrl:"SDS011:25001"},{sensorUrl:"SDS011:11554"},{sensorUrl:"SDS011:12990"},{sensorUrl:"SDS011:14803"},{sensorUrl:"SDS011:22078"},{sensorUrl:"SDS011:11552"}],{val:4},{lat:1},{lon:2},{time:9},{servicePath:"/air/gbg"},{sensor:"SDS011"},{fromDate:this.initDate}],sensorData:[]}},created:function(){this.sensorData=[[{sensorUrl:"AirQualityObserved:0001"},{sensorUrl:"AirQualityObserved:0002"},{sensorUrl:"AirQualityObserved:0003"}],{val:0},{lat:5},{lon:5},{time:12},{servicePath:"/airquality/reference"},{sensor:"AirqualityObserved"},{fromDate:this.initDate}],this.fromDate=this.initDate},methods:{getValueWhenClicked:function(e){this.newInc=e},getIncValue:function(e){this.sliderValue=e},getTimeStamp:function(e){this.timestampList=JSON.parse(JSON.stringify(e))},getTimeValue:function(e){"SDS011Selection"==this.selected?this.displayTime=e[1]:this.displayTime=e[0]},playButton:function(){this.playToggle=!this.playToggle,this.play=this.playToggle?"Pause":"Play"},prevTime:function(e){this.prev="up"!==e},nextTime:function(e){this.next="up"!==e},changeTime:function(e){this.fromDate=this.timeFormatter(e[0]),this.updateSensorvalues(this.selected)},entity:function(e){this.selected=e.target.value.split(","),this.updateSensorvalues(this.selected)},updateSensorvalues:function(e){this.selected=e;var t=e;"airqualityObservedSelection"==t&&(this.sensorData=this.dataAirqualityObserved,this.$set(this.sensorData,7,{fromDate:this.fromDate})),"NO2B43FSelection"==t&&(this.sensorData=this.dataNO2B43F,this.$set(this.sensorData,7,{fromDate:this.fromDate})),"SDS011Selection"==t&&(this.sensorData=this.dataSDS011,this.$set(this.sensorData,7,{fromDate:this.fromDate}))}}}),L=I,P=(a("034f"),Object(m["a"])(L,s,i,!1,null,null,null)),B=P.exports,M=(a("6cc5"),a("5132")),q=a.n(M);n["default"].config.productionTip=!1,n["default"].use(new q.a({debug:!0,connection:"http://localhost:3000",options:{}})),n["default"].config.productionTip=!1;var C=new n["default"];new n["default"]({render:function(e){return e(B)}}).$mount("#app")},"85ec":function(e,t,a){},a64b:function(e,t,a){"use strict";var n=a("f341"),s=a.n(n);s.a},a6b6:function(e,t,a){},e775:function(e,t,a){},f341:function(e,t,a){}});
//# sourceMappingURL=app.b977a36c.js.map